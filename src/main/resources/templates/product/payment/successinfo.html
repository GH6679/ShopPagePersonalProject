<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>success Info</title>

    <!-- bootstrap3.3.7 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- BS 3.7.7 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <!-- headOutterLinks     -->
    <th:block th:insert="fragments/product/head :: headOutterLink" />

    <style>
        #wepper_section {
            width: 100%;
        }

        .main-section {}

        .main-section-area {
            width: 1260px;
            margin: 0 auto;
        }


        .tag-labels {
            margin-right: 5px;
        }

        .btn {
            color: white;
            flex: 1;
        }

        .main-section-area>div>p {
            font-size: 18px;
            font-weight: bold;
            margin: 15px 0px 15px 15px;
            color: black;
        }

        /* êµ¬íš êµ¬ë¶„ */
        .main-section-area>div>div {
            width: 100%;
            padding: 20px 24px;
            background-color: #F8F8F8;
            border: solid 1px #d3d3d3;
            box-sizing: border-box;
        }

        /* ì¥ë°”êµ¬ë‹ˆ êµ¬ë¶„ì„  */
        .cart-list>div {
            border-top: 1px solid #c9c9c9;
        }

        .cart-list>div:nth-last-child(1) {
            border-bottom: 1px solid #c9c9c9;
        }

        /* ì¥ë°”êµ¬ë‹ˆ */
        .cart-item {
            padding: 20px 0px 20px 0px;
            display: flex;
            justify-content: space-between;

        }

        /* ì¥ë°”êµ¬ë‹ˆ ì™¼í¸ */
        .cart-item-left {
            display: flex;
        }

        /* ì¥ë°”êµ¬ë‹ˆ ì¤‘ì•™ */
        .cart-item-center {
            border-left: 1px solid #c9c9c9;
            border-right: 1px solid #c9c9c9;
            width: 470px;
        }

        /* ì¥ë°”êµ¬ë‹ˆ ì˜¤ë¥¸í¸ */
        .cart-item-right {
            display: flex;
            width: 400px;
        }

        /* ì¥ë°”êµ¬ë‹ˆ ì´ë¯¸ì§€ */
        .cart-img {
            margin-right: 10px;
            height: 100px;
            width: 100px;
        }

        /* ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì´ë¦„ */
        .cart-item-title {
            font-size: 17px;
            letter-spacing: -0.6px;
            font-weight: bold;
            color: #333;
            width: 220px;
            margin-right: 10px;

            display: flex;
        }

        /* ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ìˆ˜ëŸ‰ */
        .cart-quantity {
            width: 150px;
            border-right: 1px solid #c9c9c9;
            position: relative;
        }

        /* ìˆ˜ëŸ‰ ë²„íŠ¼ */
        .cart-quantity-btn {
            width: 28px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ìˆ˜ëŸ‰ ì¦ê°€ë²„íŠ¼íŠ¼ */
        .cart-quantity-up {
            position: absolute;
            top: 50%;
            left: 35%;
            transform: translate(-50%, -50%);
        }

        /* ìƒí’ˆ ìˆ˜ëŸ‰ */
        .cart-quantity-count {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* ìƒí’ˆ ê°ì†Œ ë²„íŠ¼ */
        .cart-quantity-down {
            position: absolute;
            top: 50%;
            right: 35%;
            transform: translate(+50%, -50%);
        }

        /* ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ê°€ê²© */
        .cart-item-price {
            font-weight: bold;
            color: #333;
            font-size: 22px;
            display: flex;
            width: 150px;
            line-height: 100px;
            justify-content: center;
            border-right: 1px solid #c9c9c9;
        }


        /* ìƒí’ˆ í†µê³„ */
        .prod-statistics {

            display: flex;
            justify-content: space-between;

        }

        /* ìƒí’ˆ êµ¬ì… ìƒí’ˆ í†µê³„ */
        .buy-prod-info {
            background: #F8F8F8;
            width: 50%;
            display: block;
            padding: 25px 45px 25px 45px;
            overflow: auto;
            position: relative;

            border-right: 1px solid #c9c9c9;
        }

        /* ìƒí’ˆ êµ¬ì… ê°€ê²© í†µê³„ */
        .buy-price-info {
            background: #F8F8F8;
            width: 50%;
            display: block;
            padding: 25px 45px 25px 45px;
            overflow: auto;
            position: relative;

            text-align: right;

        }

        /* í†µê³„ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .prod-statistics>div>div {
            font-weight: bold;
            font-size: 16px;
        }

        .s-prodname {
            color: #333;
        }

        .s-price {
            color: #333;
        }

        .s-prodname-delivery {
            color: red;
        }

        .s-price-delivery {
            color: red;
        }

        .s-price-line {
            border-top: 1px solid #c9c9c9;
        }

        .s-price-sum {
            color: #333;
        }

        /* ë©”ì¸í˜ì´ì§€ë¡œ ë²„íŠ¼ ìƒì */
        .info-complete-box {

            position: relative;
            height: 100px;

        }

        /* ë©”ì¸í˜ì´ì§€ë¡œ ë²„íŠ¼ */
        .info-complete {
            position: absolute;
            height: 45px;
            width: 300px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #complete-massage-info {
            background-color: aquamarine;
            border: 0px;

            width: 100%;
            height: 360px;

            display: flex;
            justify-content: center;
            line-height: 320px;

        }

        .complete-massage {

            font-size: 72px;
            font-weight: bold;


        }

    </style>

</head>

<body>

<div id="wepper">

    <!--  header fragment      -->
    <div th:replace="fragments/product/header_v2 :: headerFragment_no_menubar" />

    <!-- ë°”ë”” ë©”ì¸ ì„¹ì…˜ -->
    <div id="wepper_section">
        <!-- ë°”ë”” ë©”ì¸ -->
        <div class="main-section">
            <!-- ë°”ë”” ë©”ì¸ -->
            <div class="main-section-area">

                <div class="complete-massage-box">

                    <div id="complete-massage-info">
                        <div class="complete-massage">ğŸ‘ê²°ì œ ì„±ê³µ!</div>
                    </div>

                </div>

                <div class="addr-box">
                    <p>ë°°ì†¡ ì£¼ì†Œ</p>
                    <div class="user-addr"></div>

                </div>

                <div class="cart-box">
                    <p>ìƒí’ˆ ëª©ë¡</p>
                    <div class="cart-list">
                    </div>


                </div>

                <div class="statistics-box">
                    <p>ì „ì²´ í•©ê³„</p>
                    <div class="prod-statistics">

                        <div class="buy-prod-info">

                            <!-- <div class="s-prodname-delivery">ë°°ì†¡ë¹„</div> -->
                        </div>

                        <div class="buy-price-info">

                            <!-- <div class="s-price-delivery">-3,000</div>
                        <div class="s-price-line"></div>
                        <div class="s-price-sum">í•©ê³„ : 797,000</div> -->

                        </div>

                    </div>

                </div>

                <div class="info-complete-box">
                    <button class="btn btn-danger info-complete">ë©”ì¸í˜ì´ì§€ë¡œ</button>
                </div>





            </div>

        </div>

    </div>

</div>


<!-- common.js   -->
<script src="/js/common.js"></script>

<script th:inline="javascript">

    //============================================================
    //ìœ ì € ì‹ë³„
    const username = /*[[${#authentication.name}]]*/ {};
    //ì£¼ì†Œ ìƒì„± ìœ„ì¹˜
    const user_addr_El = document.querySelector('.user-addr');
    //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆëª©ë¡ ìƒì„±ìœ„ì¹˜
    const cart_list_El = document.querySelector('.cart-list');
    //ì¥ë°”êµ¬ë‹ˆ í†µê³„ ìƒì„±ìœ„ì¹˜
    const buy_prod_info_El = document.querySelector('.buy-prod-info'); //í•­ëª©
    const buy_price_info_El = document.querySelector('.buy-price-info'); //ê°€ê²©

    //============================================================

    //í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰í•  ë””í´íŠ¸ ì„¤ì •ë“¤ ì‹¤í–‰
    const init = () => {

        //ì£¼ì†Œ ë¶ˆëŸ¬ì˜¤ê¸°
        setuseraddr();

        //ì¥ë°”êµ¬ë‹ˆì— ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        listcart();

    }

    //================================================================
    //ì£¼ì†Œ ë¶ˆëŸ¬ì˜¤ê¸°
    //================================================================
    const setuseraddr = () => {

        if (username != "anonymousUser") {

            const user = { "username": username }

            axios.post('/user/addr', user)
                .then(response => {

                    const addrData = response.data;

                    var user_addr_1_El = document.createElement('div');
                    user_addr_1_El.className = 'user-addr-1';
                    user_addr_1_El.textContent = addrData.addr1;

                    var user_addr_2_El = document.createElement('div');
                    user_addr_2_El.className = 'user-addr-2';
                    user_addr_2_El.textContent = addrData.addr2;

                    user_addr_El.appendChild(user_addr_1_El);
                    user_addr_El.appendChild(user_addr_2_El);


                })
                .catch(error => console.log(error));

        }

    }

    //================================================================
    //ì¥ë°”êµ¬ë‹ˆì— ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    //================================================================
    const listcart = () => {

        if (username != "anonymousUser") {
            const user = { "username": username }
            axios.post('/product/cartlist', user, { headers: { 'Content-Type': 'application/json' } })
                .then(response => {
                    console.log(response);

                    if (response != null) {
                        const productData = response.data;

                        //ì¥ë°”êµ¬ë‹ˆ ê¸°ì¡´ ëª©ë¡ ì œê±°
                        cart_list_El.innerHTML = '';

                        //ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ ìƒì„±
                        productData.forEach(data => {

                            cart_list_El.appendChild(CreateCartList(data));

                        });


                        //ìƒí’ˆ í†µê³„ ìƒì„±
                        createStatistics(productData);

                        //ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°
                        removeCartDB();

                    }

                })
                .catch(error => console.log(error));


        }

    }

    //================================================================
    //ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°
    //================================================================
    const removeCartDB = () => {

        if (username != "anonymousUser") {
            const user = { "username": username }
            axios.post('/product/cartremoveDB', user, { headers: { 'Content-Type': 'application/json' } })
                .then(response => {

                })
                .catch(error => console.log(error));


        }

    }

    //================================================================
    //ì¥ë°”êµ¬ë‹ˆì— ëª©ë¡ ìƒì„±
    //================================================================
    const CreateCartList = (data) => {

        //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì•„ì´í…œ
        var cart_item_El = document.createElement('div');
        cart_item_El.className = "cart-item";

        //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì•„ì´í…œ ì™¼ìª½ ë¼ì¸
        var cart_item_left_El = document.createElement('div')
        cart_item_left_El.className = "cart-item-left";

        //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì´ë¯¸ì§€
        var cart_img_El = document.createElement('img')
        cart_img_El.className = "cart-img";
        cart_img_El.src = data.prodimagepaths[0];

        //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì œëª©ë€
        var cart_item_title_El = document.createElement('div')
        cart_item_title_El.className = "cart-item-title";

        //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì•„ì´í…œ ì œëª©
        var cart_item_name_El = document.createElement('a')
        cart_item_name_El.className = "cart-item-name";
        cart_item_name_El.textContent = data.prodname;
        cart_item_name_El.href = "/product/get/" + data.prodcode;

        //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì¤‘ì•™ ë¼ì¸
        var cart_item_center_El = document.createElement('div')
        cart_item_center_El.className = "cart-item-center";

        //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì˜¤ë¥¸ìª½ ë¼ì¸
        var cart_item_right_El = document.createElement('div')
        cart_item_right_El.className = "cart-item-right"

        //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ìˆ˜ëŸ‰ í‘œì‹œ
        var cart_quantity_El = document.createElement('div');
        cart_quantity_El.className = "cart-quantity";

        //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ìˆ˜ëŸ‰
        var cart_quantity_count_El = document.createElement('div');
        cart_quantity_count_El.className = "cart-quantity-count";
        cart_quantity_count_El.setAttribute('cart-no', data.cartno);
        cart_quantity_count_El.textContent = data.cartcount;

        //ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì•„ì´í…œ ê°€ê²©
        var cart_item_price_El = document.createElement('div');
        cart_item_price_El.className = "cart-item-price";
        cart_item_price_El.textContent = priceConverter(data.prodprice) + "ì›";


        cart_item_left_El.appendChild(cart_img_El);

        cart_item_left_El.appendChild(cart_item_title_El);
        cart_item_title_El.appendChild(cart_item_name_El);

        // cart_item_center_El.appendChild(cart_item_center_El);

        cart_item_right_El.appendChild(cart_quantity_El);

        cart_quantity_El.appendChild(cart_quantity_count_El);

        cart_item_right_El.appendChild(cart_item_price_El);


        cart_item_El.appendChild(cart_item_left_El);
        cart_item_El.appendChild(cart_item_center_El);
        cart_item_El.appendChild(cart_item_right_El);

        return cart_item_El;

    }

    //================================================================
    //ì¥ë°”êµ¬ë‹ˆ í†µê³„ ìƒì„±
    //================================================================
    const createStatistics = (productData) => {

        // ì´ì „ í•­ëª© ì œê±°
        buy_prod_info_El.innerHTML = '';
        buy_price_info_El.innerHTML = '';

        //ìƒí’ˆ ì´ë¦„ X ìˆ˜ëŸ‰ ìƒì„±ê¸°
        const setSProdname = (prodname, cartcount) => {

            var s_prodname_El = document.createElement('div')
            s_prodname_El.className = "s-prodname";
            s_prodname_El.textContent = prodname + ' X ' + cartcount;

            return s_prodname_El;

        }
        // ìƒí’ˆ ê°€ê²© ìƒì„±ê¸°
        const setSPrice = (prodprice, cartcount) => {

            var s_price_El = document.createElement('div');
            s_price_El.className = "s-price";
            s_price_El.textContent = "+ " + priceConverter(prodprice * cartcount) + "ì›";

            return s_price_El;

        }


        //ìƒí’ˆ í•­ëª© ìƒì„±
        productData.forEach(data => {

            buy_prod_info_El.appendChild(setSProdname(data.prodname, data.cartcount));
            buy_price_info_El.appendChild(setSPrice(data.prodprice, data.cartcount));

        })

        // ì¶”ê°€ í•­ëª© ìƒì„±

        // ë¼ì¸ ìƒì„±
        var price_line_El = document.createElement('div');
        price_line_El.className = 's-price-line';
        buy_price_info_El.appendChild(price_line_El);

        //ìµœì¢… í•©ê³„ ê³„ì‚° í›„ ìƒì„±
        axios.post('/product/cartprice', { username: username })
            .then(response => {

                var s_price_sum_El = document.createElement('div');
                s_price_sum_El.className = 's-price-sum';

                console.log(response);
                if (response !== null) {

                    s_price_sum_El.textContent = 'í•©ê³„ : ' + priceConverter(response.data) + 'ì›'

                } else {

                    s_price_sum_El.textContent = 'í•©ê³„ : 0ì›'

                }

                buy_price_info_El.appendChild(s_price_sum_El);

            })
            .catch(error => console.log(error))

    }

    //ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™ ë²„íŠ¼
    const info_complete_El = document.querySelector('.info-complete');
    info_complete_El.addEventListener('click', function(){

        window.location.href = '/product/index';

    })

    //í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰í•  ë””í´íŠ¸ ì„¤ì •ë“¤ ì‹¤í–‰
    init();

</script>


</body>

</html>