<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>success Info</title>

    <!-- bootstrap3.3.7 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- BS 3.7.7 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <!-- headOutterLinks     -->
    <th:block th:insert="fragments/product/head :: headOutterLink" />

    <style>
        #wepper_section {
            width: 100%;
        }

        .main-section {}

        .main-section-area {
            width: 1260px;
            margin: 0 auto;
        }


        .tag-labels {
            margin-right: 5px;
        }

        .btn {
            color: white;
            flex: 1;
        }

        .main-section-area>div>p {
            font-size: 18px;
            font-weight: bold;
            margin: 15px 0px 15px 15px;
            color: black;
        }

        /* Íµ¨Ìöç Íµ¨Î∂Ñ */
        .main-section-area>div>div {
            width: 100%;
            padding: 20px 24px;
            background-color: #F8F8F8;
            border: solid 1px #d3d3d3;
            box-sizing: border-box;
        }

        /* Ïû•Î∞îÍµ¨Îãà Íµ¨Î∂ÑÏÑ† */
        .cart-list>div {
            border-top: 1px solid #c9c9c9;
        }

        .cart-list>div:nth-last-child(1) {
            border-bottom: 1px solid #c9c9c9;
        }

        /* Ïû•Î∞îÍµ¨Îãà */
        .cart-item {
            padding: 20px 0px 20px 0px;
            display: flex;
            justify-content: space-between;

        }

        /* Ïû•Î∞îÍµ¨Îãà ÏôºÌé∏ */
        .cart-item-left {
            display: flex;
        }

        /* Ïû•Î∞îÍµ¨Îãà Ï§ëÏïô */
        .cart-item-center {
            border-left: 1px solid #c9c9c9;
            border-right: 1px solid #c9c9c9;
            width: 470px;
        }

        /* Ïû•Î∞îÍµ¨Îãà Ïò§Î•∏Ìé∏ */
        .cart-item-right {
            display: flex;
            width: 400px;
        }

        /* Ïû•Î∞îÍµ¨Îãà Ïù¥ÎØ∏ÏßÄ */
        .cart-img {
            margin-right: 10px;
            height: 100px;
            width: 100px;
        }

        /* Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà Ïù¥Î¶Ñ */
        .cart-item-title {
            font-size: 17px;
            letter-spacing: -0.6px;
            font-weight: bold;
            color: #333;
            width: 220px;
            margin-right: 10px;

            display: flex;
        }

        /* Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà ÏàòÎüâ */
        .cart-quantity {
            width: 150px;
            border-right: 1px solid #c9c9c9;
            position: relative;
        }

        /* ÏàòÎüâ Î≤ÑÌäº */
        .cart-quantity-btn {
            width: 28px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ÏàòÎüâ Ï¶ùÍ∞ÄÎ≤ÑÌäºÌäº */
        .cart-quantity-up {
            position: absolute;
            top: 50%;
            left: 35%;
            transform: translate(-50%, -50%);
        }

        /* ÏÉÅÌíà ÏàòÎüâ */
        .cart-quantity-count {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* ÏÉÅÌíà Í∞êÏÜå Î≤ÑÌäº */
        .cart-quantity-down {
            position: absolute;
            top: 50%;
            right: 35%;
            transform: translate(+50%, -50%);
        }

        /* Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà Í∞ÄÍ≤© */
        .cart-item-price {
            font-weight: bold;
            color: #333;
            font-size: 22px;
            display: flex;
            width: 150px;
            line-height: 100px;
            justify-content: center;
            border-right: 1px solid #c9c9c9;
        }


        /* ÏÉÅÌíà ÌÜµÍ≥Ñ */
        .prod-statistics {

            display: flex;
            justify-content: space-between;

        }

        /* ÏÉÅÌíà Íµ¨ÏûÖ ÏÉÅÌíà ÌÜµÍ≥Ñ */
        .buy-prod-info {
            background: #F8F8F8;
            width: 50%;
            display: block;
            padding: 25px 45px 25px 45px;
            overflow: auto;
            position: relative;

            border-right: 1px solid #c9c9c9;
        }

        /* ÏÉÅÌíà Íµ¨ÏûÖ Í∞ÄÍ≤© ÌÜµÍ≥Ñ */
        .buy-price-info {
            background: #F8F8F8;
            width: 50%;
            display: block;
            padding: 25px 45px 25px 45px;
            overflow: auto;
            position: relative;

            text-align: right;

        }

        /* ÌÜµÍ≥Ñ ÌÖçÏä§Ìä∏ Ïä§ÌÉÄÏùº */
        .prod-statistics>div>div {
            font-weight: bold;
            font-size: 16px;
        }

        .s-prodname {
            color: #333;
        }

        .s-price {
            color: #333;
        }

        .s-prodname-delivery {
            color: red;
        }

        .s-price-delivery {
            color: red;
        }

        .s-price-line {
            border-top: 1px solid #c9c9c9;
        }

        .s-price-sum {
            color: #333;
        }

        /* Î©îÏù∏ÌéòÏù¥ÏßÄÎ°ú Î≤ÑÌäº ÏÉÅÏûê */
        .info-complete-box {

            position: relative;
            height: 100px;

        }

        /* Î©îÏù∏ÌéòÏù¥ÏßÄÎ°ú Î≤ÑÌäº */
        .info-complete {
            position: absolute;
            height: 45px;
            width: 300px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #complete-massage-info {
            background-color: aquamarine;
            border: 0px;

            width: 100%;
            height: 360px;

            display: flex;
            justify-content: center;
            line-height: 320px;

        }

        .complete-massage {

            font-size: 72px;
            font-weight: bold;


        }

    </style>

</head>

<body>

<div id="wepper">

    <!--  header fragment      -->
    <div th:replace="fragments/product/header_v2 :: headerFragment_no_menubar" />

    <!-- Î∞îÎîî Î©îÏù∏ ÏÑπÏÖò -->
    <div id="wepper_section">
        <!-- Î∞îÎîî Î©îÏù∏ -->
        <div class="main-section">
            <!-- Î∞îÎîî Î©îÏù∏ -->
            <div class="main-section-area">

                <div class="complete-massage-box">

                    <div id="complete-massage-info">
                        <div class="complete-massage">üëçÍ≤∞Ï†ú ÏÑ±Í≥µ!</div>
                    </div>

                </div>

                <div class="addr-box">
                    <p>Î∞∞ÏÜ° Ï£ºÏÜå</p>
                    <div class="user-addr"></div>

                </div>

                <div class="cart-box">
                    <p>ÏÉÅÌíà Î™©Î°ù</p>
                    <div class="cart-list">
                    </div>


                </div>

                <div class="statistics-box">
                    <p>Ï†ÑÏ≤¥ Ìï©Í≥Ñ</p>
                    <div class="prod-statistics">

                        <div class="buy-prod-info">

                            <!-- <div class="s-prodname-delivery">Î∞∞ÏÜ°ÎπÑ</div> -->
                        </div>

                        <div class="buy-price-info">

                            <!-- <div class="s-price-delivery">-3,000</div>
                        <div class="s-price-line"></div>
                        <div class="s-price-sum">Ìï©Í≥Ñ : 797,000</div> -->

                        </div>

                    </div>

                </div>

                <div class="info-complete-box">
                    <button class="btn btn-danger info-complete">Î©îÏù∏ÌéòÏù¥ÏßÄÎ°ú</button>
                </div>





            </div>

        </div>

    </div>

</div>


<!-- common.js   -->
<script src="/js/common.js"></script>

<script th:inline="javascript">

    //============================================================
    //Ïú†Ï†Ä ÏãùÎ≥Ñ
    const username = /*[[${#authentication.name}]]*/ {};
    //Ï£ºÏÜå ÏÉùÏÑ± ÏúÑÏπò
    const user_addr_El = document.querySelector('.user-addr');
    //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíàÎ™©Î°ù ÏÉùÏÑ±ÏúÑÏπò
    const cart_list_El = document.querySelector('.cart-list');
    //Ïû•Î∞îÍµ¨Îãà ÌÜµÍ≥Ñ ÏÉùÏÑ±ÏúÑÏπò
    const buy_prod_info_El = document.querySelector('.buy-prod-info'); //Ìï≠Î™©
    const buy_price_info_El = document.querySelector('.buy-price-info'); //Í∞ÄÍ≤©

    //============================================================

    //ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ïã§ÌñâÌï† ÎîîÌè¥Ìä∏ ÏÑ§Ï†ïÎì§ Ïã§Ìñâ
    const init = () => {

        //Ï£ºÏÜå Î∂àÎü¨Ïò§Í∏∞
        setuseraddr();

        //Ïû•Î∞îÍµ¨ÎãàÏóê Î™©Î°ù Î∂àÎü¨Ïò§Í∏∞
        listcart();

    }

    //================================================================
    //Ï£ºÏÜå Î∂àÎü¨Ïò§Í∏∞
    //================================================================
    const setuseraddr = () => {

        if (username != "anonymousUser") {

            const user = { "username": username }

            axios.post('/user/addr', user)
                .then(response => {

                    const addrData = response.data;

                    var user_addr_1_El = document.createElement('div');
                    user_addr_1_El.className = 'user-addr-1';
                    user_addr_1_El.textContent = addrData.addr1;

                    var user_addr_2_El = document.createElement('div');
                    user_addr_2_El.className = 'user-addr-2';
                    user_addr_2_El.textContent = addrData.addr2;

                    user_addr_El.appendChild(user_addr_1_El);
                    user_addr_El.appendChild(user_addr_2_El);


                })
                .catch(error => console.log(error));

        }

    }

    //================================================================
    //Ïû•Î∞îÍµ¨ÎãàÏóê Î™©Î°ù Î∂àÎü¨Ïò§Í∏∞
    //================================================================
    const listcart = () => {

        if (username != "anonymousUser") {
            const user = { "username": username }
            axios.post('/product/cartlist', user, { headers: { 'Content-Type': 'application/json' } })
                .then(response => {
                    console.log(response);

                    if (response != null) {
                        const productData = response.data;

                        //Ïû•Î∞îÍµ¨Îãà Í∏∞Ï°¥ Î™©Î°ù Ï†úÍ±∞
                        cart_list_El.innerHTML = '';

                        //Ïû•Î∞îÍµ¨Îãà Î™©Î°ù ÏÉùÏÑ±
                        productData.forEach(data => {

                            cart_list_El.appendChild(CreateCartList(data));

                        });


                        //ÏÉÅÌíà ÌÜµÍ≥Ñ ÏÉùÏÑ±
                        createStatistics(productData);

                        //Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ÏóêÏÑú Ïû•Î∞îÍµ¨Îãà ÎπÑÏö∞Í∏∞
                        removeCartDB();

                    }

                })
                .catch(error => console.log(error));


        }

    }

    //================================================================
    //Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ÏóêÏÑú Ïû•Î∞îÍµ¨Îãà ÎπÑÏö∞Í∏∞
    //================================================================
    const removeCartDB = () => {

        if (username != "anonymousUser") {
            const user = { "username": username }
            axios.post('/product/cartremoveDB', user, { headers: { 'Content-Type': 'application/json' } })
                .then(response => {

                })
                .catch(error => console.log(error));


        }

    }

    //================================================================
    //Ïû•Î∞îÍµ¨ÎãàÏóê Î™©Î°ù ÏÉùÏÑ±
    //================================================================
    const CreateCartList = (data) => {

        //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà ÏïÑÏù¥ÌÖú
        var cart_item_El = document.createElement('div');
        cart_item_El.className = "cart-item";

        //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà ÏïÑÏù¥ÌÖú ÏôºÏ™Ω ÎùºÏù∏
        var cart_item_left_El = document.createElement('div')
        cart_item_left_El.className = "cart-item-left";

        //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà Ïù¥ÎØ∏ÏßÄ
        var cart_img_El = document.createElement('img')
        cart_img_El.className = "cart-img";
        cart_img_El.src = data.prodimagepaths[0];

        //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà Ï†úÎ™©ÎûÄ
        var cart_item_title_El = document.createElement('div')
        cart_item_title_El.className = "cart-item-title";

        //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà ÏïÑÏù¥ÌÖú Ï†úÎ™©
        var cart_item_name_El = document.createElement('a')
        cart_item_name_El.className = "cart-item-name";
        cart_item_name_El.textContent = data.prodname;
        cart_item_name_El.href = "/product/get/" + data.prodcode;

        //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà Ï§ëÏïô ÎùºÏù∏
        var cart_item_center_El = document.createElement('div')
        cart_item_center_El.className = "cart-item-center";

        //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà Ïò§Î•∏Ï™Ω ÎùºÏù∏
        var cart_item_right_El = document.createElement('div')
        cart_item_right_El.className = "cart-item-right"

        //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà ÏàòÎüâ ÌëúÏãú
        var cart_quantity_El = document.createElement('div');
        cart_quantity_El.className = "cart-quantity";

        //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà ÏàòÎüâ
        var cart_quantity_count_El = document.createElement('div');
        cart_quantity_count_El.className = "cart-quantity-count";
        cart_quantity_count_El.setAttribute('cart-no', data.cartno);
        cart_quantity_count_El.textContent = data.cartcount;

        //Ïû•Î∞îÍµ¨Îãà ÏÉÅÌíà ÏïÑÏù¥ÌÖú Í∞ÄÍ≤©
        var cart_item_price_El = document.createElement('div');
        cart_item_price_El.className = "cart-item-price";
        cart_item_price_El.textContent = priceConverter(data.prodprice) + "Ïõê";


        cart_item_left_El.appendChild(cart_img_El);

        cart_item_left_El.appendChild(cart_item_title_El);
        cart_item_title_El.appendChild(cart_item_name_El);

        // cart_item_center_El.appendChild(cart_item_center_El);

        cart_item_right_El.appendChild(cart_quantity_El);

        cart_quantity_El.appendChild(cart_quantity_count_El);

        cart_item_right_El.appendChild(cart_item_price_El);


        cart_item_El.appendChild(cart_item_left_El);
        cart_item_El.appendChild(cart_item_center_El);
        cart_item_El.appendChild(cart_item_right_El);

        return cart_item_El;

    }

    //================================================================
    //Ïû•Î∞îÍµ¨Îãà ÌÜµÍ≥Ñ ÏÉùÏÑ±
    //================================================================
    const createStatistics = (productData) => {

        // Ïù¥Ï†Ñ Ìï≠Î™© Ï†úÍ±∞
        buy_prod_info_El.innerHTML = '';
        buy_price_info_El.innerHTML = '';

        //ÏÉÅÌíà Ïù¥Î¶Ñ X ÏàòÎüâ ÏÉùÏÑ±Í∏∞
        const setSProdname = (prodname, cartcount) => {

            var s_prodname_El = document.createElement('div')
            s_prodname_El.className = "s-prodname";
            s_prodname_El.textContent = prodname + ' X ' + cartcount;

            return s_prodname_El;

        }
        // ÏÉÅÌíà Í∞ÄÍ≤© ÏÉùÏÑ±Í∏∞
        const setSPrice = (prodprice, cartcount) => {

            var s_price_El = document.createElement('div');
            s_price_El.className = "s-price";
            s_price_El.textContent = "+ " + priceConverter(prodprice * cartcount) + "Ïõê";

            return s_price_El;

        }


        //ÏÉÅÌíà Ìï≠Î™© ÏÉùÏÑ±
        productData.forEach(data => {

            buy_prod_info_El.appendChild(setSProdname(data.prodname, data.cartcount));
            buy_price_info_El.appendChild(setSPrice(data.prodprice, data.cartcount));

        })

        // Ï∂îÍ∞Ä Ìï≠Î™© ÏÉùÏÑ±

        // ÎùºÏù∏ ÏÉùÏÑ±
        var price_line_El = document.createElement('div');
        price_line_El.className = 's-price-line';
        buy_price_info_El.appendChild(price_line_El);

        //ÏµúÏ¢Ö Ìï©Í≥Ñ Í≥ÑÏÇ∞ ÌõÑ ÏÉùÏÑ±
        axios.post('/product/cartprice', { username: username })
            .then(response => {

                var s_price_sum_El = document.createElement('div');
                s_price_sum_El.className = 's-price-sum';

                console.log(response);
                if (response !== null) {

                    s_price_sum_El.textContent = 'Ìï©Í≥Ñ : ' + priceConverter(response.data) + 'Ïõê'

                } else {

                    s_price_sum_El.textContent = 'Ìï©Í≥Ñ : 0Ïõê'

                }

                buy_price_info_El.appendChild(s_price_sum_El);

            })
            .catch(error => console.log(error))

    }

    //Î©îÏù∏ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô Î≤ÑÌäº
    const info_complete_El = document.querySelector('.info-complete');
    info_complete_El.addEventListener('click', function(){

        window.location.href = '/product/index';

    })

    //ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ïã§ÌñâÌï† ÎîîÌè¥Ìä∏ ÏÑ§Ï†ïÎì§ Ïã§Ìñâ
    init();

</script>


</body>

</html>